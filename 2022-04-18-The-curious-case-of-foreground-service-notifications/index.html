<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true"></title><link rel="icon" href="/favicon-32x32.png?v=5c064402d8c94391a8a5abea59f08f1d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#02aab0"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=5c064402d8c94391a8a5abea59f08f1d"/><link as="script" rel="preload" href="/webpack-runtime-c195b5133cbf8202a4ef.js"/><link as="script" rel="preload" href="/framework-9f244bd18e1797a5d73c.js"/><link as="script" rel="preload" href="/app-28be362e6dd77be70772.js"/><link as="script" rel="preload" href="/6e3616a45e8e5c0213e250bbdb78bee17c21e4a7-7238c2a62e3c167833ae.js"/><link as="script" rel="preload" href="/component---src-blog-2022-04-18-the-curious-case-of-foreground-service-notifications-mdx-ccd753c62dc60ffd46a3.js"/><link as="fetch" rel="preload" href="/page-data/2022-04-18-The-curious-case-of-foreground-service-notifications/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="blogpage"><a href="/blog" duration="1000">Back</a></div><div class="blogText"><h1 color="#f9f9f9"></h1><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div><h1>A background on background work in Android</h1><p>When I first got into Android development, background services were kinda <a href="https://android-developers.googleblog.com/2010/02/service-api-changes-starting-with.html">unrestricted</a></p><p>Because the Services API is so <strong>powerful</strong> and being able to do things in the background while persisting the app&#x27;s <a href="https://proandroiddev.com/android-internals-101-how-android-os-starts-you-application-e1c98a014c05#:~:text=According%20to%20dictionary%20definition%3A%20Zygote,thus%20achieving%20fast%20app%20launches.">process</a> can
actually affect the device&#x27;s performance due to contention (Memory, CPU) and usage (battery), developers certainly have a responsibility to use services wisely.</p><p>One more thing to note is progressive restrictions from Android 8.0&#x27;s <a href="https://developer.android.com/about/versions/oreo/background">background execution limits</a></p><p>My favourite API to do long running background processing in Android is thusly <a href="https://developer.android.com/topic/libraries/architecture/workmanager/advanced/long-running">WorkManager</a></p><h1>Foreground services and notifications</h1><p>Of course Android supports long running operations that the user explicitly requests. These are run by posting status bar notifications and using <a href="https://developer.android.com/guide/components/foreground-services#notification-immediate">foreground services</a></p><p>The rationale behind this is that</p><ul><li><p>The user has explicitly requested a long running operation that can persist outside of the app being killed.</p></li><li><p>The notification is visible to the user throughout the duration of this long running operation.</p></li></ul><p>So, I suppose the question here to ask is <strong>what would happen if the user has explicitly turned off ALL notifications in the app&#x27;s settings?</strong></p><p>Let&#x27;s find out by creating a sample app that does this.</p><ul><li>First we create a Service and declare it in the app&#x27;s <code>AndroidManifest.xml</code></li></ul><pre><code>    &lt;service
            android:name=&quot;.SomeService&quot;
            android:enabled=&quot;true&quot;
            android:exported=&quot;false&quot; /&gt;
</code></pre><ul><li>Create <code>SomeService</code></li></ul><pre><code>    class SomeService : Service() {

        companion object {
            const val CHANNEL_NAME = &quot;serviceChannel&quot;
            const val CHANNEL_ID = &quot;channelId&quot;
            const val TITLE = &quot;SomeService up&quot;
            const val MESSAGE = &quot;SomeService is now running&quot;
            val targetActivity = HomeActivity::class.java
            const val NOTIFICATION_ID = 0
        }

        override fun onBind(intent: Intent): IBinder? = null

        override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
            val target = Intent(this, targetActivity)
            val targetIntent =
                PendingIntent.getActivity(this, 1, target, PendingIntent.FLAG_UPDATE_CURRENT)

            val notificationManager =
                getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager
            val notification = NotificationCompat.Builder(this, CHANNEL_ID)
                .setContentTitle(TITLE)
                .setContentText(MESSAGE)
                .setNotificationSilent()
                .setSmallIcon(R.drawable.ic_launcher_foreground)
                .setContentIntent(targetIntent)
                .build()

            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {
                val channel = NotificationChannel(
                    CHANNEL_ID,
                    CHANNEL_NAME,
                    NotificationManager.IMPORTANCE_DEFAULT
                )
                notificationManager.createNotificationChannel(channel)
            }

            if (Build.VERSION.SDK_INT &gt;= 29) {
                startForeground(startId, notification, ServiceInfo.FOREGROUND_SERVICE_TYPE_NONE)
            } else {
                startForeground(startId, notification)
            }

            serviceStarted = true
            return START_NOT_STICKY
        }

        override fun stopService(name: Intent?): Boolean {
            serviceStarted = false
            return super.stopService(name)
        }
    }
</code></pre><ul><li><code>ServiceNotifier</code> is a <code>Singleton</code> that sets/unsets the <code>serviceStarted</code> flag. This is just for us to debug <code>SomeService</code> when notifications are turned off.</li></ul><pre><code>    object ServiceStartedNotifier {
        var serviceStarted = false   
    }
</code></pre><ul><li><code>HomeActivity</code> is just the launcher activity.</li></ul><pre><code>    class HomeActivity : AppCompatActivity() {
        override fun onCreate(savedInstanceState: Bundle?) {
            super.onCreate(savedInstanceState)
            setContentView(R.layout.activity_main)

            if (!serviceStarted) {
                val serviceIntent = Intent(this, SomeService::class.java)
                startService(serviceIntent)
            }
        
        // poll for `SomeService` being up/ down.
        val scope = CoroutineScope(Dispatchers.IO)
        scope.launch {
            while (true) {
                delay(2000)
                withContext(Dispatchers.Main) {
                    txt_status.text = if (serviceStarted) &quot;Service is up&quot; else &quot;Service is down&quot;
                }
            }
        }
    }

    // Not strictly required, but saves me from killing the service manually.
    override fun onDestroy() {
        super.onDestroy()
        serviceStarted = false
        stopService(Intent(this, SomeService::class.java))
    }
</code></pre><ul><li><code>activity_main.xml</code> is just an xml layout. I should probably have written this in Jetpack Compose!</li></ul><pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
        xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;
        xmlns:tools=&quot;http://schemas.android.com/tools&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;match_parent&quot;
        tools:context=&quot;.HomeActivity&quot;&gt;

            &lt;TextView
            android:id=&quot;@+id/txt_status&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_marginTop=&quot;16dp&quot;
            android:gravity=&quot;center&quot;
            android:textIsSelectable=&quot;true&quot;
            app:layout_constraintBottom_toBottomOf=&quot;parent&quot;
            app:layout_constraintEnd_toEndOf=&quot;parent&quot;
            app:layout_constraintStart_toStartOf=&quot;parent&quot;
            app:layout_constraintTop_toTopOf=&quot;parent&quot; /&gt;
    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;
</code></pre><div align="center"><h3> Ok, now for the big reveal</h3><video width="30%" controls="" autoplay="" src="/static/copy_pasta-a847dc822caecc2266a384fc0cc527fa.webm" type="video/mp4"></video><p><strong>That&#x27;s right. For foreground services, if the user stops showing notifications, this just stops the service from posting notifications! However, the
service and its processing still seems to be working as normal</strong></p><img src="https://media.giphy.com/media/aLdiZJmmx4OVW/giphy.gif"/></div></div><br/><br/><br/><br/><p>Questions? Suggestions? Compliments? Tips to make this post better? I&#x27;d love to hear your thoughts <a href="https://twitter.com/overjeer">on twitter</a></p></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2022-04-18-The-curious-case-of-foreground-service-notifications";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b2d4371ac86bd4794756.js"],"app":["/app-28be362e6dd77be70772.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-ad6431e4664bcf916d19.js"],"component---src-blog-2016-12-30-license-details-mdx":["/component---src-blog-2016-12-30-license-details-mdx-54636640cb9de6a2199b.js"],"component---src-blog-2016-12-30-why-dropbox-mdx":["/component---src-blog-2016-12-30-why-dropbox-mdx-1bce888f7d2ed8e5ea65.js"],"component---src-blog-2016-12-31-privacy-policy-mdx":["/component---src-blog-2016-12-31-privacy-policy-mdx-04c96da1f3faa33d0449.js"],"component---src-blog-2017-03-31-privacy-policy-straya-mate-mdx":["/component---src-blog-2017-03-31-privacy-policy-straya-mate-mdx-b46c6fc4ae982337af88.js"],"component---src-blog-2017-11-17-google-play-games-for-fun-and-profit-but-mostly-fun-mdx":["/component---src-blog-2017-11-17-google-play-games-for-fun-and-profit-but-mostly-fun-mdx-8a1f137307407bd14cb9.js"],"component---src-blog-2017-12-09-app-monetisation-and-in-app-billing-implementation-mdx":["/component---src-blog-2017-12-09-app-monetisation-and-in-app-billing-implementation-mdx-b068dc012a5543dfd03f.js"],"component---src-blog-2018-03-25-privacy-policy-strayamate-i-os-mdx":["/component---src-blog-2018-03-25-privacy-policy-strayamate-i-os-mdx-84ea0008678b6a952746.js"],"component---src-blog-2018-03-25-privacy-policy-turnt-app-i-os-mdx":["/component---src-blog-2018-03-25-privacy-policy-turnt-app-i-os-mdx-13ed9d234e16fbf02154.js"],"component---src-blog-2019-01-13-footy-stars-mdx":["/component---src-blog-2019-01-13-footy-stars-mdx-108a1a089b110dd51c81.js"],"component---src-blog-2019-01-30-strayamate-lite-mdx":["/component---src-blog-2019-01-30-strayamate-lite-mdx-1468ca4a5bea1ba2ac53.js"],"component---src-blog-2019-03-18-testing-android-q-beta-without-an-actual-pixel-device-is-hard-mdx":["/component---src-blog-2019-03-18-testing-android-q-beta-without-an-actual-pixel-device-is-hard-mdx-66ca809b050c808a8771.js"],"component---src-blog-2019-04-06-in-app-billing-implementation-v-1-2-mdx":["/component---src-blog-2019-04-06-in-app-billing-implementation-v-1-2-mdx-fe2256d434863a712596.js"],"component---src-blog-2019-04-14-foldable-emulators-in-android-studio-mdx":["/component---src-blog-2019-04-14-foldable-emulators-in-android-studio-mdx-680f5cd605c2c6896ede.js"],"component---src-blog-2019-05-02-zen-of-conferences-mdx":["/component---src-blog-2019-05-02-zen-of-conferences-mdx-2e3dfe42b9dffce24cae.js"],"component---src-blog-2019-05-14-privacy-policy-aussie-slang-action-on-google-mdx":["/component---src-blog-2019-05-14-privacy-policy-aussie-slang-action-on-google-mdx-a1b3eb20c17d767f9763.js"],"component---src-blog-2019-06-01-io-2019-a-11-y-mdx":["/component---src-blog-2019-06-01-io-2019-a-11-y-mdx-7025534d445ef7032ca3.js"],"component---src-blog-2019-09-28-relasing-an-app-mdx":["/component---src-blog-2019-09-28-relasing-an-app-mdx-8f1479ac946c0f9d0183.js"],"component---src-blog-2019-12-08-huxtable-android-privacy-policy-mdx":["/component---src-blog-2019-12-08-huxtable-android-privacy-policy-mdx-4e57aae2c3030eb9a3c2.js"],"component---src-blog-2019-12-08-huxtable-privacy-policy-mdx":["/component---src-blog-2019-12-08-huxtable-privacy-policy-mdx-f15fd0a22695e37e23ee.js"],"component---src-blog-2019-12-09-huxtable-preview-mdx":["/component---src-blog-2019-12-09-huxtable-preview-mdx-b71b1a25551ba8e03459.js"],"component---src-blog-2020-02-09-huxtable-preview-android-i-phone-mdx":["/component---src-blog-2020-02-09-huxtable-preview-android-i-phone-mdx-4e5a3d109519180d556c.js"],"component---src-blog-2020-03-06-privacy-policy-handwash-hygiene-mdx":["/component---src-blog-2020-03-06-privacy-policy-handwash-hygiene-mdx-e0084ea637e2c082bfba.js"],"component---src-blog-2020-04-25-testing-behaviour-changes-android-11-mdx":["/component---src-blog-2020-04-25-testing-behaviour-changes-android-11-mdx-7adc3ba4f8e345b25b11.js"],"component---src-blog-2020-05-08-particle-paradox-privacy-policy-mdx":["/component---src-blog-2020-05-08-particle-paradox-privacy-policy-mdx-07e866f98753abd405d6.js"],"component---src-blog-2020-08-22-in-app-reviews-play-core-api-mdx":["/component---src-blog-2020-08-22-in-app-reviews-play-core-api-mdx-57813eca5ff0c642fa0c.js"],"component---src-blog-2020-12-26-a-neat-trick-for-testing-on-the-play-store-mdx":["/component---src-blog-2020-12-26-a-neat-trick-for-testing-on-the-play-store-mdx-f3f7deae60e8e90026c2.js"],"component---src-blog-2021-04-14-privacy-policy-anzac-day-stickers-mdx":["/component---src-blog-2021-04-14-privacy-policy-anzac-day-stickers-mdx-e3c0355c1513becf080b.js"],"component---src-blog-2021-04-22-privacy-policy-family-stickers-mdx":["/component---src-blog-2021-04-22-privacy-policy-family-stickers-mdx-29844b72a2696ec2028a.js"],"component---src-blog-2022-03-17-firebase-remove-unused-push-tokens-mdx":["/component---src-blog-2022-03-17-firebase-remove-unused-push-tokens-mdx-bf1e22da20f9d009e567.js"],"component---src-blog-2022-04-05-notification-permissions-android-13-mdx":["/component---src-blog-2022-04-05-notification-permissions-android-13-mdx-8369c469242f0182beaa.js"],"component---src-blog-2022-04-18-the-curious-case-of-foreground-service-notifications-mdx":["/component---src-blog-2022-04-18-the-curious-case-of-foreground-service-notifications-mdx-ccd753c62dc60ffd46a3.js"],"component---src-pages-404-js":["/component---src-pages-404-js-2338b72a15441f9fccfa.js"],"component---src-pages-app-ads-txt-js":["/component---src-pages-app-ads-txt-js-399937ebead7acd627c3.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-3f414e6cae799ae475cd.js"],"component---src-pages-index-js":["/component---src-pages-index-js-fc78d8086419e105aa0e.js"]};/*]]>*/</script><script src="/polyfill-b2d4371ac86bd4794756.js" nomodule=""></script><script src="/component---src-blog-2022-04-18-the-curious-case-of-foreground-service-notifications-mdx-ccd753c62dc60ffd46a3.js" async=""></script><script src="/6e3616a45e8e5c0213e250bbdb78bee17c21e4a7-7238c2a62e3c167833ae.js" async=""></script><script src="/app-28be362e6dd77be70772.js" async=""></script><script src="/framework-9f244bd18e1797a5d73c.js" async=""></script><script src="/webpack-runtime-c195b5133cbf8202a4ef.js" async=""></script></body></html>